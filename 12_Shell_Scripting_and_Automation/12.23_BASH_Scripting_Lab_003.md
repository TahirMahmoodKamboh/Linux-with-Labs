# Command Substitution

Here we will cover **what command substitution is**, **how to use it**, and **simple example scripts**.

---

## üîπ What is Command Substitution?

**Command substitution** allows you to **use the output of a command as a value** in your script.

Syntax:

```bash
# Using backticks (old style)
variable=`command`

# Using $() (preferred)
variable=$(command)
```

* `command` ‚Üí any valid shell command
* The **output of the command** replaces `$(command)` or `` `command` ``
* This is **widely used to assign values or use in expressions**

---

## üîπ Example 1: Get current date

```bash
#!/bin/bash

today=$(date)   # store output of 'date' command
echo "Today's date is: $today"
```

**Output:**

```
Today's date is: Mon Jan 6 17:30:12 PKT 2026
```

‚úÖ Explanation:

* `$(date)` runs the `date` command
* Its output is stored in `today` variable
* You can use it anywhere in the script

---

## üîπ Example 2: Count files in current directory

```bash
#!/bin/bash

file_count=$(ls | wc -l)
echo "There are $file_count files in the current directory."
```

**Output example:**

```
There are 15 files in the current directory.
```

‚úÖ Explanation:

* `ls` lists files
* `wc -l` counts lines (files)
* Command substitution stores the result in `file_count`

---

## üîπ Example 3: Use command output in arithmetic

```bash
#!/bin/bash

num1=5
num2=$(echo 10)   # command that outputs 10

sum=$((num1 + num2))
echo "Sum of $num1 and $num2 is $sum"
```

**Output:**

```
Sum of 5 and 10 is 15
```

‚úÖ Explanation:

* `$(echo 10)` outputs 10
* `sum=$((num1 + num2))` uses it in arithmetic

---

## üîπ Example 4: Use `command substitution` in a loop

```bash
#!/bin/bash

for user in $(cut -d: -f1 /etc/passwd | head -5)
do
    echo "User: $user"
done
```

**Output example:**

```
User: root
User: daemon
User: bin
User: sys
User: sync
```

‚úÖ Explanation:

* `cut -d: -f1 /etc/passwd` gets all usernames
* `head -5` takes first 5
* `$(...)` outputs a list of words for the loop

---

## üîπ Example 5: Using command output in conditional

```bash
#!/bin/bash

disk_usage=$(df / | tail -1 | awk '{print $5}' | sed 's/%//')

if [ "$disk_usage" -gt 80 ]; then
    echo "Warning: Disk usage is above 80% ($disk_usage%)"
else
    echo "Disk usage is safe ($disk_usage%)"
fi
```

‚úÖ Explanation:

* `df /` ‚Üí checks root filesystem usage
* `awk '{print $5}'` ‚Üí get percentage
* `sed 's/%//'` ‚Üí remove `%` sign
* Command substitution stores numeric value in `disk_usage`

---

### üí° Tips for Command Substitution

1. Prefer `$()` over backticks `` `command` ``
2. Use `$(...)` inside **strings or arithmetic**
3. Can be **nested**, e.g.,

```bash
echo "Today is $(date +%A), week number $(date +%V)"
```

4. Works with **loops, variables, conditions, calculations**

---
### üí° Some real world examples:

Here are **5 super short, real-world examples** using **command substitution** that are **5‚Äì10 lines each** for practice.

---

## **1Ô∏è‚É£ Check number of users logged in and list them**

```bash
#!/bin/bash

user_count=$(who | wc -l)
users=$(who | awk '{print $1}' | tr '\n' ' ')

echo "There are $user_count users logged in: $users"
```

‚úÖ **Explanation:**

* `who | wc -l` ‚Üí count of logged-in users
* `who | awk '{print $1}'` ‚Üí list usernames
* `tr '\n' ' '` ‚Üí make it one line

**Example output:**

```
There are 3 users logged in: root alice bob
```

---

## **2Ô∏è‚É£ Show disk usage of root in GB**

```bash
#!/bin/bash

total=$(df / | tail -1 | awk '{print $2}')
used=$(df / | tail -1 | awk '{print $3}')
free=$(df / | tail -1 | awk '{print $4}')

echo "Root partition: Total=$(($total/1024))MB Used=$(($used/1024))MB Free=$(($free/1024))MB"
```

‚úÖ **Explanation:**

* Each `df` + `awk` fetches total, used, and free space
* Command substitution stores values for calculation

**Example output:**

```
Root partition: Total=51200MB Used=20480MB Free=30720MB
```

---

## **3Ô∏è‚É£ Show system info in one line**

```bash
#!/bin/bash

hostname=$(hostname)
os=$(uname -s)
kernel=$(uname -r)
uptime=$(uptime -p)

echo "System: $hostname, OS: $os, Kernel: $kernel, Uptime: $uptime"
```

‚úÖ **Explanation:**

* Multiple command substitutions for a **summary of system info**
* Each command provides a small piece of data

**Example output:**

```
System: myserver, OS: Linux, Kernel: 5.15.0-99-generic, Uptime: up 2 hours, 15 minutes
```

---

## **4Ô∏è‚É£ Count text files and largest one in directory**

```bash
#!/bin/bash

txt_count=$(ls *.txt 2>/dev/null | wc -l)
largest=$(ls -S *.txt 2>/dev/null | head -1)

echo "Text files: $txt_count, Largest file: $largest"
```

‚úÖ **Explanation:**

* `ls *.txt` ‚Üí list text files
* `ls -S` ‚Üí sort by size
* `head -1` ‚Üí largest file

**Example output:**

```
Text files: 7, Largest file: report.txt
```

---

## **5Ô∏è‚É£ Show top 3 memory-consuming processes**

```bash
#!/bin/bash

top_processes=$(ps aux --sort=-%mem | head -4 | tail -3 | awk '{print $1,$11,$4"%"}')

echo -e "Top 3 memory-consuming processes:\n$top_processes"
```

‚úÖ **Explanation:**

* `ps aux --sort=-%mem` ‚Üí sort by memory
* `head -4 | tail -3` ‚Üí skip header, take top 3
* `awk` formats output

**Example output:**

```
Top 3 memory-consuming processes:
root /usr/bin/python3 12%
alice /usr/lib/firefox/firefox 10%
bob /usr/bin/java 8%
```

---


